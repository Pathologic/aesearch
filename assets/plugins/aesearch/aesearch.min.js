window.AESearch=class{options={wrapperClass:"aesearch",resultsClass:"aesearch-results",inputName:"search",url:"/aesearch",headers:{"X-Requested-With":"XMLHttpRequest"},minSearch:3};constructor(e={}){if("object"!=typeof e)throw new Error("Wrong options");"object"==typeof e.headers&&Object.assign(this.options.headers,e.headers),delete e.headers,Object.assign(this.options,e),this.init()}init(){Array.from(document.getElementsByClassName(this.options.wrapperClass)).forEach((e=>{const s=e.querySelector('input[name="'+this.options.inputName+'"]');s&&(s.addEventListener("input",this.debounce(this.submit),!1),s.addEventListener("focus",(s=>{let t=e.getElementsByClassName(this.options.resultsClass)[0];""!==t.innerHTML&&""!==s.target.value&&t.classList.remove("hidden")}),!1));const t=document.createElement("div");t.classList.add("aesearch-results","hidden"),e.appendChild(t),document.addEventListener("click",(s=>{e.contains(s.target)||t.classList.add("hidden")}))}))}debounce(e,s=300){let t;return(...i)=>{window.clearTimeout(t),t=window.setTimeout((()=>{e.apply(this,i)}),s)}}submit(e){const s=e.target,t=s.closest("."+this.options.wrapperClass).getElementsByClassName(this.options.resultsClass)[0],i=s.value;i.length<this.options.minSearch?t.classList.add("hidden"):this.request({search:i},(e=>{e.status?(t.innerHTML=e.results,t.classList.remove("hidden")):t.classList.add("hidden")}),(e=>{console.log(e),t.classList.add("hidden")}))}request(e,s,t){fetch(new Request(this.options.url,{method:"post",credentials:"same-origin",headers:Object.assign(this.options.headers,{Accept:"application/json","Content-type":"application/json"}),body:JSON.stringify(e)})).then((e=>{if(!e.ok)throw new Error;return e.json()})).then(s).catch(t)}};